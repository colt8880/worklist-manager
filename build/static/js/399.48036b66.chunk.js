"use strict";(self.webpackChunkworklist_manager=self.webpackChunkworklist_manager||[]).push([[399],{4399:(e,t,o)=>{o.r(t),o.d(t,{ProjectsView:()=>ue,default:()=>pe});var n=o(9379),r=o(5043),l=o(6727),a=o(6446),s=o(1637),i=o(2664),c=o(3336),d=o(5865),u=o(1906),p=o(6258),h=o(7392),m=o(5795),x=o(1787),j=o(1322),g=o(8734),A=o(2437),f=o(2143),C=o(5721),v=o(8082),y=o(6360),b=o(4802);var w=o(35),S=o(6600),P=o(5316),D=o(9347),k=o(579);const E=e=>{let{open:t,onClose:o,onSave:n,currentName:l}=e;const[a,s]=(0,r.useState)(l);(0,r.useEffect)((()=>{s(l)}),[l]);return(0,k.jsx)(w.A,{open:t,onClose:o,children:(0,k.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a.trim()&&(n(a.trim()),o())},children:[(0,k.jsx)(S.A,{children:"Edit Project Name"}),(0,k.jsx)(P.A,{children:(0,k.jsx)(m.A,{autoFocus:!0,margin:"dense",label:"Project Name",fullWidth:!0,value:a,onChange:e=>s(e.target.value)})}),(0,k.jsxs)(D.A,{children:[(0,k.jsx)(u.A,{onClick:o,children:"Cancel"}),(0,k.jsx)(u.A,{type:"submit",variant:"contained",disabled:!a.trim(),children:"Save"})]})]})})},I=e=>{let{searchTerm:t,isVisible:o,onSearch:n,onVisibilityChange:l}=e;const s=(0,r.useRef)(null);return(0,r.useEffect)((()=>{o&&s.current&&s.current.focus()}),[o]),(0,k.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",mb:2,gap:1,position:"relative",height:40},children:[(0,k.jsx)(p.A,{in:!o,children:(0,k.jsx)(h.A,{onClick:()=>l(!0),sx:{position:"absolute",left:0},"aria-label":"Show search",children:(0,k.jsx)(y.A,{})})}),(0,k.jsx)(p.A,{in:o,children:(0,k.jsxs)(a.A,{sx:{maxWidth:{xs:"100%",sm:"50%",md:"25%"},minWidth:"200px",display:"flex",gap:1,position:"absolute",left:0,transition:"all 0.3s ease-in-out"},children:[(0,k.jsx)(m.A,{fullWidth:!0,variant:"outlined",placeholder:"Search projects...",value:t,onChange:e=>n(e.target.value),inputRef:s,InputProps:{startAdornment:(0,k.jsx)(x.A,{position:"start",children:(0,k.jsx)(y.A,{color:"action"})})},size:"small"}),(0,k.jsx)(h.A,{onClick:()=>{l(!1),n("")},size:"small","aria-label":"Hide search",children:(0,k.jsx)(b.A,{})})]})})]})},N=e=>{let{project:t,menuAnchor:o,onMenuOpen:n,onMenuClose:r,onProjectOpen:l,onProjectEdit:s,onProjectDelete:i}=e;return(0,k.jsxs)(j.Ay,{onClick:l,sx:{border:"1px solid",borderColor:"rgba(132, 172, 206, 0.2)",borderRadius:1,mb:1,cursor:"pointer","&:hover":{backgroundColor:"rgba(26, 169, 98, 0.04)"}},children:[(0,k.jsx)(g.A,{primary:t.name,secondaryTypographyProps:{component:"div"},secondary:(0,k.jsxs)(a.A,{component:"span",sx:{display:"flex",gap:2,color:"text.secondary",typography:"body2"},children:[(0,k.jsxs)("span",{children:["Records: ",t.recordCount]}),(0,k.jsxs)("span",{children:["Updated: ",(c=t.updatedAt,new Date(c).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]})}),(0,k.jsx)(h.A,{onClick:e=>{e.stopPropagation(),n(e)},size:"small","aria-label":"More options",children:(0,k.jsx)(v.A,{})}),(0,k.jsxs)(A.A,{anchorEl:o,open:Boolean(o),onClose:r,children:[(0,k.jsx)(f.A,{onClick:e=>{e.stopPropagation(),r(),s()},children:"Edit"}),(0,k.jsx)(f.A,{onClick:e=>{e.stopPropagation(),r(),i()},sx:{color:"error.main"},children:"Delete"})]})]});var c},F=e=>{let{projects:t,onOpenProject:o,onDeleteProject:n,onEditProject:l}=e;const[s,i]=(0,r.useState)({}),[c,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)(null),[m,x]=(0,r.useState)(""),[j,g]=(0,r.useState)(!1),A=t.filter((e=>e.name.toLowerCase().includes(m.toLowerCase())));return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(I,{searchTerm:m,isVisible:j,onSearch:x,onVisibilityChange:g}),(0,k.jsxs)(C.A,{children:[A.map((e=>(0,k.jsx)(N,{project:e,menuAnchor:s[e.id],onMenuOpen:t=>i({[e.id]:t.currentTarget}),onMenuClose:()=>i({[e.id]:null}),onProjectOpen:()=>o(e.id),onProjectEdit:()=>{h({id:e.id,name:e.name}),u(!0)},onProjectDelete:()=>n(e.id)},e.id))),0===A.length&&(0,k.jsx)(a.A,{sx:{textAlign:"center",py:4},children:(0,k.jsx)(d.A,{color:"text.secondary",children:m?"No projects match your search":"No projects yet"})})]}),p&&(0,k.jsx)(E,{open:c,onClose:()=>{u(!1),h(null)},onSave:e=>{l(p.id,e),u(!1),h(null)},currentName:p.name})]})};var T=o(2505);const M=e=>{let{onNewProject:t}=e;return(0,k.jsx)(a.A,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"calc(100vh - 300px)",textAlign:"center",px:2,mt:-8},children:(0,k.jsxs)(c.A,{elevation:0,sx:{p:4,display:"flex",flexDirection:"column",alignItems:"center",maxWidth:400,width:"100%",bgcolor:"transparent"},children:[(0,k.jsx)(d.A,{variant:"h5",component:"h2",gutterBottom:!0,sx:{mb:2,color:"text.primary",fontWeight:500},children:"Create a New Project to Get Started"}),(0,k.jsx)(u.A,{variant:"contained",size:"large",onClick:t,startIcon:(0,k.jsx)(T.A,{}),sx:{mt:2,py:1.5,px:4,borderRadius:2,textTransform:"none",fontSize:"1.1rem"},children:"Add Project"})]})})},O=e=>{let{projects:t,onNewProject:o,onOpenProject:n,onDeleteProject:r,onEditProject:l}=e;return 0===t.length?(0,k.jsx)(M,{onNewProject:o}):(0,k.jsxs)(a.A,{children:[(0,k.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,k.jsx)(d.A,{variant:"h5",children:"Projects"}),(0,k.jsx)(u.A,{variant:"contained",onClick:o,startIcon:(0,k.jsx)(T.A,{}),children:"New Project"})]}),(0,k.jsx)(F,{projects:t,onOpenProject:n,onDeleteProject:r,onEditProject:l})]})};var R=o(45),V=o(9526),U=o(611),W=o(3374),B=o(5766),L=o.n(B);const z=e=>{let{onFileUpload:t}=e;const[o,n]=(0,r.useState)(!1),[l,s]=(0,r.useState)(null),[p,h]=(0,r.useState)(0),[m,x]=(0,r.useState)(0),[j,g]=(0,r.useState)(0),A=(0,r.useCallback)((async e=>{var o;const r=null===(o=e.target.files)||void 0===o?void 0:o[0];if(!r)return void s("No file selected");n(!0),s(null),h(0),x(r.size),g(0);const l=new FileReader;l.onprogress=e=>{if(e.lengthComputable){const t=Math.round(e.loaded/e.total*50);h(t)}},l.onload=e=>{var o;const r=null===(o=e.target)||void 0===o?void 0:o.result,l=[];let a=[];L().parse(r,{header:!0,skipEmptyLines:"greedy",step:(e,t)=>{if(e.data&&"object"===typeof e.data){l.push(e.data);const t=Math.min(95,50+Math.round(l.length/(r.length/100)*45));h(t)}e.errors&&e.errors.length>0&&(a=a.concat(e.errors))},complete:()=>{if(a.length>0)return s("Error parsing CSV file: ".concat(a[0].message)),void n(!1);if(!l||0===l.length)return s("No data found in file"),void n(!1);const e=l[0];if("object"!==typeof e||null===e)return s("Invalid CSV format: First row is not a valid object"),void n(!1);const o=Object.keys(e);if(l.some((e=>"object"===typeof e&&null!==e&&!o.every((t=>Object.prototype.hasOwnProperty.call(e,t))))))return s("Invalid CSV format: Some rows are missing columns"),void n(!1);try{h(95),t(l),h(100),n(!1)}catch(r){s("Failed to process file data"),n(!1)}},error:e=>{s("Error reading file: ".concat(e.message)),n(!1)}})},l.onerror=()=>{s("Error reading the file"),n(!1)},l.readAsText(r)}),[t]);return(0,k.jsxs)(c.A,{sx:{p:4,textAlign:"center",border:"2px dashed rgba(132, 172, 206, 0.3)",backgroundColor:"rgba(132, 172, 206, 0.05)",transition:"all 0.2s ease","&:hover":{borderColor:"#1AA962",backgroundColor:"rgba(26, 169, 98, 0.05)"}},children:[(0,k.jsxs)(a.A,{sx:{mb:2},children:[(0,k.jsx)("input",{accept:".csv",style:{display:"none"},id:"file-upload",type:"file",onChange:A}),(0,k.jsx)("label",{htmlFor:"file-upload",children:(0,k.jsx)(u.A,{variant:"contained",component:"span",startIcon:(0,k.jsx)(W.A,{}),disabled:o,sx:{backgroundColor:"#1AA962","&:hover":{backgroundColor:"#158c51"}},children:"Upload CSV File"})}),(0,k.jsx)(d.A,{variant:"body2",color:"textSecondary",sx:{mt:1},children:"Drag and drop a CSV file here or click to select"})]}),o&&(0,k.jsxs)(a.A,{sx:{width:"100%",mt:2},children:[(0,k.jsx)(U.A,{variant:"determinate",value:p,sx:{height:10,borderRadius:5,"& .MuiLinearProgress-bar":{borderRadius:5,backgroundColor:"#1AA962"}}}),(0,k.jsxs)(a.A,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[(0,k.jsx)(d.A,{variant:"body2",color:"textSecondary",children:p<100?"Processing...":"Complete!"}),(0,k.jsxs)(d.A,{variant:"body2",color:"textSecondary",children:[p,"%"]})]}),m>0&&(0,k.jsxs)(d.A,{variant:"caption",color:"textSecondary",children:["File size: ",(e=>{if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]})(m)]})]}),l&&(0,k.jsx)(i.A,{severity:"error",sx:{mt:2},children:l})]})};var G=o(5180),H=o(4267),K=o(4666),$=o(8511),q=o(9336),Q=o(3217),_=o(697),Z=o(430),J=o(3536),X=o.n(J);function Y(e){const{hideMenu:t,colDef:o}=e;return(0,k.jsxs)("div",{children:[(0,k.jsx)(G.aU,(0,n.A)({},e)),(0,k.jsx)(q.A,{}),(0,k.jsxs)(f.A,{onClick:e=>{if(e.preventDefault(),e.stopPropagation(),window.confirm("Are you sure you want to delete this column? This action cannot be undone.")){const e=new CustomEvent("deleteColumn",{detail:o.field});window.dispatchEvent(e)}t({stopPropagation:()=>{}})},"data-testid":"delete-column-menu-item",sx:{padding:"6px 16px",display:"flex",alignItems:"center",minHeight:"32px",color:"error.main","& .MuiSvgIcon-root":{fontSize:"1.25rem",color:"error.main",marginRight:2}},children:[(0,k.jsx)(_.A,{}),"Delete Column"]})]})}const ee=e=>{let{data:t,columns:o,customColumns:l,onUpdateCell:s,onDeleteColumn:i}=e;const c=(0,H.b)(),d=(0,r.useMemo)((()=>(console.log("Processing rows with IDs:",{dataLength:t.length,hasIds:t.every((e=>void 0!==e.id)),firstFewRows:t.slice(0,3)}),t.every((e=>void 0!==e.id))?t.map((e=>(0,n.A)((0,n.A)({},e),{},{id:String(e.id)}))):(console.warn("Some rows are missing IDs, assigning new ones"),t.map(((e,t)=>(0,n.A)((0,n.A)({},e),{},{id:void 0!==e.id?String(e.id):String(t)})))))),[t]),u=r.useCallback((async(e,t)=>{try{if(X().isEqual(e,t))return t;const o=Object.keys(e).find((o=>"id"!==o&&!X().isEqual(e[o],t[o])));if(!o)return console.warn("[DataTable] No changed column found between:",{newRow:e,oldRow:t}),t;console.log("[DataTable] Updating cell:",{rowId:e.id,column:o,oldValue:t[o],newValue:e[o]});const r=await s(e.id,o,e[o]);if(!r)return console.warn("[DataTable] Update cell returned no result"),t;return(0,n.A)((0,n.A)({},r),{},{isNew:!1})}catch(o){return console.error("[DataTable] Error processing row update:",{error:o,rowId:e.id}),t}}),[s]);r.useEffect((()=>{const e=e=>{null===i||void 0===i||i(e.detail)};return window.addEventListener("deleteColumn",e),()=>{window.removeEventListener("deleteColumn",e)}}),[i]);const p=r.useCallback((async e=>{try{const{id:t,field:o,value:n}=e,r=!n;return!!await s(t,o,r)}catch(t){return console.error("[DataTable] Error handling checkbox change:",{error:t,params:e}),!1}}),[s]),h=(0,r.useMemo)((()=>o.map((e=>{const t=l[e],o={field:e,headerName:(null===t||void 0===t?void 0:t.headerName)||e,flex:1,minWidth:150,editable:!0,description:(null===t||void 0===t?void 0:t.description)||""};if(t){if("boolean"===t.type)return(0,n.A)((0,n.A)({},o),{},{type:"boolean",renderCell:e=>(0,k.jsx)(Q.A,{checked:Boolean(e.value),onChange:()=>p(e)})});if("singleSelect"===t.type)return(0,n.A)((0,n.A)({},o),{},{type:"singleSelect",valueOptions:t.options||[],valueFormatter:e=>e?void 0===e.value||null===e.value?"":String(e.value):"",renderCell:e=>(console.log("[DataTable] Rendering singleSelect cell:",{id:e.id,field:e.field,value:e.value,valueType:typeof e.value}),(0,k.jsxs)(a.A,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:"pointer",padding:0},onClick:t=>{t.stopPropagation(),c.current.startCellEditMode({id:e.id,field:e.field})},children:[(0,k.jsx)("span",{style:{overflow:"hidden",textOverflow:"ellipsis",flex:1,paddingLeft:"8px"},children:e.value||""}),(0,k.jsx)(Z.A,{sx:{color:"rgba(0, 0, 0, 0.54)",marginLeft:1,marginRight:1,fontSize:20,flexShrink:0}})]}))})}return o}))),[o,l,p]);return(0,k.jsx)(a.A,{sx:{width:"100%",height:400},children:(0,k.jsx)($.z,{apiRef:c,rows:d,columns:h,autoHeight:!0,disableRowSelectionOnClick:!0,processRowUpdate:u,onProcessRowUpdateError:e=>{console.error("[DataGrid] Error in row update:",e)},slots:{columnMenu:Y},editMode:"cell",onCellEditStop:(e,t)=>{const{id:o,field:n,reason:r}=e;if(r===K.Q.cellFocusOut||r===K.Q.enterKeyDown){console.log("[DataTable] Cell edit stopped:",{id:o,field:n,reason:r});const e=c.current.getCellValue(o,n);console.log("[DataTable] New cell value:",{id:o,field:n,newValue:e}),void 0!==e&&s(o,n,e).catch((e=>{console.error("[DataTable] Error updating cell from edit stop event:",e)}))}},sx:{"& .MuiDataGrid-cell":{borderRight:"1px solid rgba(224, 224, 224, 1)"},"& .MuiDataGrid-columnHeader":{borderRight:"1px solid rgba(224, 224, 224, 1)",backgroundColor:"rgba(0, 0, 0, 0.02)","& .MuiDataGrid-columnHeaderTitle":{fontWeight:700}}}})})};var te=o(3193),oe=o(9190),ne=o(2221);const re=e=>{let{open:t,onClose:o,onAdd:l,existingColumns:s}=e;const[i,c]=(0,r.useState)({name:"",type:"string",headerName:"",description:"",options:[],flex:1,minWidth:150,editable:!0}),[d,p]=(0,r.useState)("");return(0,k.jsxs)(w.A,{open:t,onClose:o,maxWidth:"sm",fullWidth:!0,children:[(0,k.jsx)(S.A,{children:"Add New Column"}),(0,k.jsx)(P.A,{children:(0,k.jsxs)(a.A,{sx:{display:"flex",flexDirection:"column",gap:2,mt:1},children:[(0,k.jsx)(m.A,{label:"Column Name",value:i.name,onChange:e=>c((0,n.A)((0,n.A)({},i),{},{name:e.target.value})),error:s.includes(i.name),helperText:s.includes(i.name)?"Column name already exists":"",required:!0}),(0,k.jsx)(m.A,{label:"Column Header",value:i.headerName||"",onChange:e=>c((0,n.A)((0,n.A)({},i),{},{headerName:e.target.value})),helperText:"Display name for the column (optional)"}),(0,k.jsxs)(te.A,{fullWidth:!0,children:[(0,k.jsx)(oe.A,{children:"Column Type"}),(0,k.jsxs)(ne.A,{value:i.type,label:"Column Type",onChange:e=>c((0,n.A)((0,n.A)({},i),{},{type:e.target.value})),children:[(0,k.jsx)(f.A,{value:"string",children:"Text"}),(0,k.jsx)(f.A,{value:"boolean",children:"Checkbox"}),(0,k.jsx)(f.A,{value:"singleSelect",children:"Select List"})]})]}),"singleSelect"===i.type&&(0,k.jsx)(m.A,{label:"Options",value:d,onChange:e=>p(e.target.value),helperText:"Enter options separated by commas",fullWidth:!0}),(0,k.jsx)(m.A,{label:"Description",value:i.description||"",onChange:e=>c((0,n.A)((0,n.A)({},i),{},{description:e.target.value})),helperText:"Tooltip text shown on hover (optional)",multiline:!0,rows:2})]})}),(0,k.jsxs)(D.A,{children:[(0,k.jsx)(u.A,{onClick:o,children:"Cancel"}),(0,k.jsx)(u.A,{onClick:()=>{if(i.name.trim()&&!s.includes(i.name)){const e=(0,n.A)((0,n.A)({},i),{},{headerName:i.headerName||i.name,options:"singleSelect"===i.type?d.split(",").map((e=>e.trim())).filter(Boolean):void 0,valueOptions:"singleSelect"===i.type?d.split(",").map((e=>e.trim())).filter(Boolean):void 0});l(e),c({name:"",type:"string",headerName:"",description:"",options:[],flex:1,minWidth:150,editable:!0}),p(""),o()}},variant:"contained",disabled:!i.name.trim()||s.includes(i.name),children:"Add Column"})]})]})};var le=o(779);const ae=e=>{let{data:t,columns:o,onDataUpdate:l,onClearData:s,customColumns:i,onAddCustomColumn:c,onUpdateData:p,currentProject:m,setCurrentProject:x,onBackToProjects:j,userId:g}=e;const[C,y]=(0,r.useState)(!1),[b,E]=(0,r.useState)(null),[I,N]=(0,r.useState)(!1),F=()=>{E(null)};return(0,k.jsx)(k.Fragment,{children:0===t.length?(0,k.jsx)(z,{onFileUpload:async e=>{try{if(e.length>0){const t=e.map(((e,t)=>(0,n.A)((0,n.A)({},e),{},{id:String(t)}))),o=Object.keys(e[0]).filter((e=>"id"!==e));await l(t,o)}}catch(t){console.error("Error uploading file:",t)}}}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(a.A,{sx:{display:"flex",justifyContent:"flex-end",alignItems:"flex-start",mt:-5,mb:2},children:[(0,k.jsx)(h.A,{onClick:e=>{E(e.currentTarget)},sx:{mt:-.5,p:.5},children:(0,k.jsx)(v.A,{})}),(0,k.jsxs)(A.A,{anchorEl:b,open:Boolean(b),onClose:F,children:[(0,k.jsx)(f.A,{onClick:()=>{F(),y(!0)},children:"Add Column"}),(0,k.jsx)(f.A,{onClick:()=>{F(),N(!0)},children:"Upload New File"})]})]}),(0,k.jsx)(ee,{data:t,columns:o,customColumns:(null===m||void 0===m?void 0:m.customColumns)||{},onUpdateCell:async(e,t,o)=>await p(e,t,o),onDeleteColumn:async e=>{if(m)try{const r=m.customColumns||{},{[e]:a}=r,s=(0,R.A)(r,[e].map(V.A)),i=o.filter((t=>t!==e)),c=t.map((t=>{const{[e]:o}=t;return(0,R.A)(t,[e].map(V.A))})),d=(0,n.A)((0,n.A)({},m),{},{customColumns:s,columns:i,data:c,updatedAt:(new Date).toISOString()}),u=await le.$.saveProject(g,d);x(u),l(c,i)}catch(r){console.error("Failed to delete column:",r)}}}),(0,k.jsx)(re,{open:C,onClose:()=>y(!1),onAdd:c,existingColumns:o}),(0,k.jsxs)(w.A,{open:I,onClose:()=>N(!1),children:[(0,k.jsx)(S.A,{children:"Confirm New Upload"}),(0,k.jsx)(P.A,{children:(0,k.jsx)(d.A,{children:"Uploading a new file will delete all existing data in this project. Are you sure you want to continue?"})}),(0,k.jsxs)(D.A,{children:[(0,k.jsx)(u.A,{onClick:()=>N(!1),children:"Cancel"}),(0,k.jsx)(u.A,{onClick:()=>{N(!1),s()},color:"error",variant:"contained",children:"Upload New File"})]})]})]})})},se=e=>{let{open:t,onClose:o,onCreate:n}=e;const[l,a]=(0,r.useState)("");(0,r.useEffect)((()=>{t&&a("")}),[t]);return(0,k.jsx)(w.A,{open:t,onClose:o,children:(0,k.jsxs)("form",{onSubmit:e=>{e.preventDefault(),l.trim()&&(n(l.trim()),a(""),o())},children:[(0,k.jsx)(S.A,{children:"Create New Project"}),(0,k.jsx)(P.A,{children:(0,k.jsx)(m.A,{autoFocus:!0,margin:"dense",label:"Project Name",fullWidth:!0,value:l,onChange:e=>a(e.target.value)})}),(0,k.jsxs)(D.A,{children:[(0,k.jsx)(u.A,{onClick:o,children:"Cancel"}),(0,k.jsx)(u.A,{type:"submit",variant:"contained",disabled:!l.trim(),children:"Create"})]})]})})};var ie=o(2153),ce=o(2222),de=o(9706);const ue=()=>{const{projects:e,currentProject:t,isLoading:o,error:c,data:d,columns:u}=(0,ie.GV)((e=>e.projects)),{isNewProjectOpen:p}=(0,ie.GV)((e=>e.ui.dialog)),{user:h}=(0,ie.GV)((e=>e.auth)),m=(0,ie.jL)(),{projectId:x}=(0,l.g)(),j=(0,l.Zp)(),g=r.useRef(!1);(0,r.useEffect)((()=>{h&&m((0,ce.vj)(h.id))}),[m,h]),(0,r.useEffect)((()=>{if(!x)return void(g.current||null===t||(m((0,ce.lK)(null)),m((0,ce.dD)()),g.current=!0));g.current=!1;(async()=>{if(h)try{const e=await le.$.getProject(h.id,x);e?m((0,ce.lK)(e)):j("/projects")}catch(c){console.error("Failed to load project:",c),j("/projects")}})()}),[x,h,m,j]);const A=e=>{j("/projects/".concat(e))},f=async e=>{if(h)try{const t=await m((0,ce.gA)({name:e,userId:h.id})).unwrap();m((0,de.uE)(!1)),j("/projects/".concat(t.id))}catch(c){console.error("Failed to create project:",c)}},C=async e=>{if(h)try{await m((0,ce.xx)({userId:h.id,projectId:e})).unwrap(),x===e&&j("/projects")}catch(c){console.error("Failed to delete project:",c)}},v=async(e,t)=>{if(h)try{await m((0,ce.vr)({userId:h.id,projectId:e,name:t})).unwrap()}catch(c){console.error("Failed to update project:",c)}};return o&&!e.length?(0,k.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,k.jsx)(s.A,{})}):c?(0,k.jsx)(i.A,{severity:"error",sx:{mt:4},children:c}):x?o||!t||t.id!==x?(0,k.jsx)(a.A,{sx:{display:"flex",justifyContent:"center",mt:4},children:(0,k.jsx)(s.A,{})}):(0,k.jsx)(ae,{currentProject:t,data:d,columns:u,customColumns:t.customColumns,onDataUpdate:async(e,o)=>{if(h&&t)try{await m((0,ce.nv)({userId:h.id,projectId:t.id,data:e,columns:o})).unwrap()}catch(c){console.error("Failed to update project data:",c)}},onClearData:()=>m((0,ce.dD)()),onAddCustomColumn:async e=>{if(h&&t)try{const o=(0,n.A)((0,n.A)({},t.customColumns),{},{[e.name]:e}),r=[...t.columns,e.name],l=(0,n.A)((0,n.A)({},t),{},{customColumns:o,columns:r,data:t.data,updatedAt:(new Date).toISOString()}),a=await le.$.saveProject(h.id,l);m((0,ce.lK)(a))}catch(c){console.error("Failed to add custom column:",c)}},onUpdateData:async(e,o,r)=>{if(!h||!t)return null;try{console.log("[ProjectsView] Updating cell:",{rowId:e,column:o,value:r,valueType:typeof r}),m((0,ce.k9)({rowId:e,column:o,value:r}));const l=d.find((t=>t.id===e));if(!l)return console.error("[ProjectsView] Row not found:",e),null;const a=d.map((t=>t.id===e?(0,n.A)((0,n.A)({},t),{},{[o]:r}):t));le.$.saveProject(h.id,(0,n.A)((0,n.A)({},t),{},{data:a,updatedAt:(new Date).toISOString()})).then((()=>{console.log("[ProjectsView] Cell update saved to database successfully")})).catch((e=>{console.error("[ProjectsView] Failed to save to database:",e)}));const s=(0,n.A)((0,n.A)({},l),{},{id:e,[o]:r});return console.log("[ProjectsView] Returning updated row:",s),s}catch(c){return console.error("[ProjectsView] Failed to update cell:",c),null}},onBackToProjects:()=>{j("/projects")},userId:(null===h||void 0===h?void 0:h.id)||"",setCurrentProject:e=>m((0,ce.lK)(e))}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(O,{projects:e.map((e=>({id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,recordCount:e.data.length}))),onNewProject:()=>m((0,de.uE)(!0)),onOpenProject:A,onDeleteProject:C,onEditProject:v}),(0,k.jsx)(se,{open:p,onClose:()=>m((0,de.uE)(!1)),onCreate:f})]})},pe=ue}}]);
//# sourceMappingURL=399.48036b66.chunk.js.map